# whoami

* Small golang server to get the server's information

## How to deploy
* set /etc/hosts as
    ```
    127.0.0.1  pubg.local
    127.0.0.1  prig.local
    127.0.0.1  traefik.local
    ```
* note: in linux environment, must use the host interface ip address instead of 127.0.0.1 in order to work with docker swarm

## How to use
* public gateway
    - https GET https://pubg.local:8000/pubg
* private gateway
    - https GET https://prig.local:8000/prig
* will response JSON of hostname and IP addresses
* Note
    + if docker-compose.yml is used, use "curl localhost:8000/"
    + if docker-stack.yml is used, use "curl [local ip address]:8000/"

## Sticky session
* add traefik v1.7 load balancer in front of gateway for sicky session
* upgrade to use traefik v2.5

## Self-signed Certificate
* script "./cert/cert/sh" is used to generate self-signed certificate
* those "kam.com.*" files are generated by invoking "./cert/cert.sh kam.com 127.0.0.1"

## Issues
* keep fail to set tls.options with mtls settings
    + added "traefik.http.routers.gateway.tls.options=prig@file", but fail to add the tls.options.prig to the router
    + fixed with
        - append "/etc/hosts" with "127.0.0.1 whoami.local"
        - change router rule to rule=Host(`whoami.local`) instead of using PathPrefix()

## References
* [How to maintain Session Persistence (Sticky Session) in Docker Swarm](http://www.littlebigextra.com/how-to-maintain-session-persistence-sticky-session-in-docker-swarm-with-multiple-containers/)
* [Entry Points Definition](https://doc.traefik.io/traefik/v1.7/configuration/entrypoints/)
* [mkcert](https://github.com/FiloSottile/mkcert)
* traefik v1:
    + [Traefik Proxy with HTTPS](https://dockerswarm.rocks/traefik-v1/traefik/)
    + [Traefik v1.x](https://jellyfin.org/docs/general/networking/traefik.html)
    + [Managing Multiple Microservices with Traefik in Docker Swarm](https://boxboat.com/2017/10/10/managing-multiple-microservices-with-traefik-in-docker-swarm/)
    + [How to maintain Session Persistence (Sticky Session) in Docker Swarm](http://www.littlebigextra.com/how-to-maintain-session-persistence-sticky-session-in-docker-swarm-with-multiple-containers/)
    + [Basics](https://doc.traefik.io/traefik/v1.7/basics/)
* traefik v2:
    + [How To Use Traefik v2 as a Reverse Proxy for Docker Containers on Ubuntu 20.04](https://www.digitalocean.com/community/tutorials/how-to-use-traefik-v2-as-a-reverse-proxy-for-docker-containers-on-ubuntu-20-04)
    + [Integrate Traefik 2.1 Reverse Proxy with Docker Swarm Services](https://betterprogramming.pub/traefik-2-1-as-a-reverse-proxy-c9e274da0a32)
    + [Traefik Docker Example and Introduction](https://www.middlewareinventory.com/blog/traefik-docker/)
    + [Traefik v2 with Docker Swarm](https://dev.to/ohffs/traefik-v2-with-docker-swarm-2cgh)
    + [Traefik v2 examples](https://github.com/DoTheEvo/Traefik-v2-examples)
    + [traefik examples](https://github.com/frigi83/traefik-examples)
    + [Traefik Proxy with HTTPS](https://dockerswarm.rocks/traefik/)
    + [Traefik 2.0 & Docker 101](https://traefik.io/blog/traefik-2-0-docker-101-fc2893944b9d/)
    + [Traefik 2 & TLS 101](https://traefik.io/blog/traefik-2-tls-101-23b4fbee81f1/)
    + [Container orchestration with Docker Swarm and Traefik](https://www.cometari.com/case-study/container-orchestration-with-docker-swarm-and-traefik)
    + [Yet Another mTLS Tutorial](https://dev.to/badgerbadgerbadgerbadger/yet-another-mtls-tutorial-10pp)
    + [Docker container management with Traefik v2 and Portainer](https://rafrasenberg.com/posts/docker-container-management-with-traefik-v2-and-portainer/)
    + [Traefik 2 High Available Mode](https://levelup.gitconnected.com/traefik-2-high-available-mode-d09c9ec36295)
* haproxy:
    + [The Four Essential Sections of an HAProxy Configuration](https://www.haproxy.com/blog/the-four-essential-sections-of-an-haproxy-configuration/)
    + [HAProxy on Docker Swarm: Load Balancing and DNS Service Discovery](https://www.haproxy.com/blog/haproxy-on-docker-swarm-load-balancing-and-dns-service-discovery/)
    + [Deploy HAProxy as Load Balancer for Docker Swarm Mode](https://www.sysnet-admin.com/2021/03/deploy-haproxy-as-load-balancer-for-docker-swarm-mode/)
